{% extends "layout.html" %}

{% block title %}{{ post.title if post.title else '감정 일기' }} - Moodiary{% endblock %}

{% block content %}
  <h2>{{ post.title if post.title else '[제목 없는 감정]' }}</h2>

  <p>{{ post.content }}</p>
  <p><small>작성자: {{ post.author.name }} | {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>

  <p>❤️ 공감 {{ post.likes | length }}개</p>

  {% if current_user.is_authenticated %}
    {% set liked = false %}
    {% for like in post.likes %}
      {% if like.user.id == current_user.id %}
        {% set liked = true %}
      {% endif %}
    {% endfor %}

    <form action="{{ url_for('like', post_id=post.id) }}" method="post">
      <button type="submit">
        {% if liked %}
          공감 취소하기
        {% else %}
          공감하기
        {% endif %}
      </button>
    </form>
  {% endif %}

  <hr>

  {% if current_user.is_authenticated and current_user.id == post.author.id %}
    <details>
      <summary>[수정하기]</summary>
      <form method="post">
        <label>제목:</label><br>
        <input type="text" name="title" value="{{ post.title }}" required><br><br>

        <label>내용:</label><br>
        <textarea name="content" rows="10" cols="50" required>{{ post.content }}</textarea><br><br>

        <button type="submit">수정 완료</button>
      </form>
    </details>

    <form method="post" action="{{ url_for('delete_post', post_id=post.id) }}" onsubmit="return confirm('정말 삭제하시겠습니까?');">
      <button type="submit" style="margin-top:10px;">삭제하기</button>
    </form>
  {% endif %}

  <br>
  <a href="{{ url_for('index') }}">[목록으로]</a>
{% endblock %}
